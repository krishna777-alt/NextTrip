<%- include("navBar")%>
<title>Room Details</title>

<script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>

<body class="bg-gray-100">
  <!-- Page Container -->
  <div class="max-w-7xl mx-auto px-6 py-10">
    <!-- Header -->
    <div
      class="mb-6 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4"
    >
      <div>
        <a
          href="javascript:history.back()"
          class="text-sm text-gray-500 hover:underline"
        >
          ← Back
        </a>

        <h1 class="text-3xl font-semibold mt-2"><%= room.roomTypeCode %></h1>

        <div class="flex items-center gap-3 mt-1 text-sm text-gray-500">
          <span>
            Max <%= room.maxOccupancy %> guests (<%= room.adults %> adults, <%=
            room.children %> children)
          </span>

          <% if(room.ac === "AC"){ %>
          <span
            class="px-2 py-0.5 bg-green-100 text-green-700 rounded-full text-xs"
          >
            AC
          </span>
          <% } %>
        </div>
      </div>

      <!-- PRICE -->
      <div class="text-right">
        <p class="text-sm text-gray-500">Price per night</p>
        <p class="text-3xl font-bold text-indigo-600">
          ₹<%= room.price.toLocaleString() %>
        </p>
      </div>
    </div>

    <!-- Main Grid -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
      <!-- LEFT CONTENT -->
      <div class="lg:col-span-2 space-y-8">
        <!-- Image Gallery -->
        <!-- Modern Image Gallery -->
        <div id="gallery" class="grid grid-cols-4 grid-rows-2 gap-4">
          <!-- Main Image -->
          <div
            class="col-span-2 row-span-2 relative overflow-hidden rounded-2xl group cursor-pointer"
          >
            <img
              src="/uploads/hotels/<%= room.roomPhotos[0] %>"
              data-index="0"
              class="gallery-img w-full h-full object-cover transition-transform duration-500 group-hover:scale-105"
            />
            <div
              class="absolute inset-0 bg-gradient-to-t from-black/30 to-transparent"
            ></div>
          </div>

          <!-- Side Images -->
          <% const maxImages = 4; %> <% room.roomPhotos.slice(0,
          maxImages).forEach((image, index) => { %>
          <div
            class="relative overflow-hidden rounded-2xl group aspect-square cursor-pointer"
          >
            <img
              src="/uploads/hotels/<%= image %>"
              data-index="<%= index + 1 %>"
              class="gallery-img w-full h-full object-cover transition-transform duration-500 group-hover:scale-105"
            />

            <!-- Dark hover overlay -->
            <div
              class="absolute inset-0 bg-black/10 opacity-0 group-hover:opacity-100 transition"
            ></div>

            <!-- +N Photos Overlay -->
            <% if (index === maxImages - 1 && room.roomPhotos.length >
            maxImages) { %>
            <div
              class="absolute inset-0 bg-black/60 flex items-center justify-center text-white text-xl font-semibold"
            >
              +<%= room.roomPhotos.length - maxImages %> photos
            </div>
            <% } %>
          </div>
          <% }) %>
        </div>

        <!-- Tabs -->
        <div class="flex gap-6 border-b pb-3 text-sm font-medium">
          <span class="text-indigo-600 border-b-2 border-indigo-600 pb-2">
            Overview
          </span>
          <span class="text-gray-500">Rooms</span>
          <span class="text-gray-500">Amenities</span>
          <span class="text-gray-500">Policies</span>
        </div>

        <!-- Overview -->
        <div class="bg-white rounded-xl p-6 shadow-sm space-y-5">
          <h2 class="text-xl font-semibold">Property overview</h2>

          <div class="grid grid-cols-2 md:grid-cols-3 gap-4 text-sm">
            <div class="flex items-center gap-2">✔ Free Wi-Fi</div>
            <div class="flex items-center gap-2">✔ Air conditioning</div>
            <div class="flex items-center gap-2">✔ Private bathroom</div>
            <div class="flex items-center gap-2">✔ Free parking</div>
            <div class="flex items-center gap-2">✔ 24-hour front desk</div>
            <div class="flex items-center gap-2">✔ Key card access</div>
          </div>

          <p class="text-gray-600 leading-relaxed">
            This spacious luxury room offers modern comfort with premium
            interiors, soft lighting, and a calm atmosphere. Ideal for couples,
            families, or business travelers looking for a relaxing stay.
          </p>
          <div class="bg-white rounded-xl p-6 shadow-sm">
            <h2 class="text-xl font-semibold mb-4">Room Details</h2>

            <div class="grid grid-cols-2 md:grid-cols-3 gap-6 text-sm">
              <div>
                <p class="text-gray-500">Room Size</p>
                <p class="font-medium">
                  <%= room.sizeSqM ? room.sizeSqM + " m²" : "Not specified" %>
                </p>
              </div>

              <div>
                <p class="text-gray-500">Max Occupancy</p>
                <p class="font-medium"><%= room.maxOccupancy %> Guests</p>
              </div>

              <div>
                <p class="text-gray-500">Air Conditioning</p>
                <p class="font-medium"><%= room.ac %></p>
              </div>

              <div>
                <p class="text-gray-500">Adults</p>
                <p class="font-medium"><%= room.adults %></p>
              </div>

              <div>
                <p class="text-gray-500">Children</p>
                <p class="font-medium"><%= room.children %></p>
              </div>

              <div>
                <p class="text-gray-500">Hotel ID</p>
                <p class="font-medium truncate"><%= room.hotelID %></p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- RIGHT SIDE: STICKY BOOKING FORM -->
      <div class="lg:col-span-1">
        <div
          class="bg-white p-6 rounded-xl shadow-sm border sticky top-10 h-fit"
        >
          <h3 class="text-xl font-semibold mb-5">Book Room</h3>

          <form
            method="post"
            action="http://localhost:3000/bookingRoom"
            class="space-y-5"
          >
            <div>
              <input
                name="roomID"
                type="hidden"
                class="w-full p-3 mt-2 border rounded-lg"
                value="<%= room._id%>"
              />
            </div>
            <div>
              <label class="font-medium">Your Name</label>
              <input
                name="name"
                type="text"
                class="w-full p-3 mt-2 border rounded-lg"
              />
            </div>

            <div>
              <label class="font-medium">Phone Number</label>
              <input
                name="phone"
                type="text"
                class="w-full p-3 mt-2 border rounded-lg"
              />
            </div>

            <div>
              <label class="font-medium">Check-in Date</label>
              <input
                name="checkInDate"
                type="date"
                class="w-full p-3 mt-2 border rounded-lg"
              />
            </div>

            <div>
              <label class="font-medium">Check-out Date</label>
              <input
                name="checkOutDate"
                type="date"
                class="w-full p-3 mt-2 border rounded-lg"
              />
            </div>

            <div>
              <label class="font-medium">Adults</label>
              <select name="adults" class="w-full p-3 mt-2 border rounded-lg">
                <option>1</option>
                <option>2</option>
                <option>3</option>
                <option>4</option>
              </select>
            </div>

            <div>
              <label class="font-medium">Children</label>
              <select name="children" class="w-full p-3 mt-2 border rounded-lg">
                <option>0</option>
                <option>1</option>
                <option>2</option>
              </select>
            </div>

            <div>
              <label class="font-medium">Room Type</label>
              <select
                name="roomTypeCode"
                class="w-full p-3 mt-2 border rounded-lg"
              >
                <option>KNG_DLX</option>
                <option>DBL_STD</option>
              </select>
            </div>

            <div>
              <label class="font-medium">Room Number</label>
              <select name="roomNum" class="w-full p-3 mt-2 border rounded-lg">
                <option><%= room.roomNum%></option>

                <!-- <option>2</option>
                <option>3</option> -->
              </select>
            </div>
            <%if(!user){%>
            <a
              href="http://localhost:3000/login"
              class="group relative w-full inline-flex items-center justify-center gap-2 bg-black text-white py-3 rounded-xl text-lg font-semibold shadow-lg shadow-black/20 transition-all duration-300 hover:shadow-xl hover:-translate-y-[1px] active:scale-[0.98]"
            >
              <!-- Lock Icon -->
              <svg
                class="w-5 h-5 opacity-90"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  d="M12 11c1.657 0 3 1.343 3 3v3H9v-3c0-1.657 1.343-3 3-3zm6 0V8a6 6 0 10-12 0v3"
                />
              </svg>

              Login to Continue
            </a>

            <%}else{%> <% if(!room.isBooked){%>
            <button
              class="w-full bg-indigo-600 text-white py-3 rounded-xl text-lg hover:bg-indigo-700"
            >
              Book Now
            </button>
            <%} else{%>
            <button
              class="w-full bg-black text-white py-3 rounded-xl text-lg font-medium opacity-95 shadow-inner cursor-not-allowed"
              disabled
            >
              Reserved
            </button>
            <%}%> <%}%>
          </form>
        </div>
      </div>
    </div>
    <!-- ROOM AVAILABILITY -->
    <div class="bg-white rounded-xl p-6 shadow-sm">
      <div class="flex items-center justify-between mb-4">
        <h2 class="text-xl font-semibold">Room Availability</h2>
        <span class="text-sm text-gray-500">
          <%= totalRooms - bookedRooms %> of <%= totalRooms %> rooms available
        </span>
      </div>

      <!-- LEGEND -->
      <div class="flex gap-4 text-sm mb-4">
        <span> Rooms: <%= room.roomNum %></span>
        <% if(room.isBooked){%>
        <div class="flex items-center gap-2">
          <span class="w-4 h-4 rounded-full bg-gray-900"></span>
          Unavailable
        </div>
        <%}else{%>
        <div class="flex items-center gap-2">
          <span class="w-4 h-4 rounded-full bg-blue-500"></span>
          Available
        </div>

        <%}%>
      </div>

      <!-- ROOMS GRID -->
    </div>
  </div>
</body>
<%- include("footer")%>
<!-- Lightbox -->
<div
  id="lightbox"
  class="fixed inset-0 bg-black/90 hidden z-50 flex items-center justify-center"
>
  <!-- Close -->
  <button
    id="closeLightbox"
    class="absolute top-6 right-6 text-white text-3xl hover:scale-110 transition"
  >
    ✕
  </button>

  <!-- Image -->
  <img
    id="lightboxImage"
    class="max-w-[90%] max-h-[85%] rounded-2xl shadow-2xl transition-all"
  />

  <!-- Navigation -->
  <button
    id="prev"
    class="absolute left-6 text-white text-4xl hover:scale-110 transition"
  >
    ‹
  </button>
  <button
    id="next"
    class="absolute right-6 text-white text-4xl hover:scale-110 transition"
  >
    ›
  </button>
</div>
<script>
  document.addEventListener("DOMContentLoaded", () => {
    const images = [
      "/uploads/hotels/<%= room.mainImage %>"
      <% if (room.roomPhotos?.length) { %>,
        <% room.roomPhotos.forEach(img => { %>
          "/uploads/hotels/<%= img %>",
        <% }) %>
      <% } %>
    ];

    const galleryImgs = document.querySelectorAll(".gallery-img");
    const lightbox = document.getElementById("lightbox");
    const lightboxImg = document.getElementById("lightboxImage");

    let currentIndex = 0;

    galleryImgs.forEach(img => {
      img.addEventListener("click", () => {
        currentIndex = Number(img.dataset.index);
        lightboxImg.src = images[currentIndex];
        lightbox.classList.remove("hidden");
        document.body.style.overflow = "hidden";
      });
    });

    function closeLightbox() {
      lightbox.classList.add("hidden");
      document.body.style.overflow = "";
    }

    function nextImage() {
      currentIndex = (currentIndex + 1) % images.length;
      lightboxImg.src = images[currentIndex];
    }

    function prevImage() {
      currentIndex = (currentIndex - 1 + images.length) % images.length;
      lightboxImg.src = images[currentIndex];
    }

    document.getElementById("closeLightbox").onclick = e => {
      e.stopPropagation();
      closeLightbox();
    };

    document.getElementById("next").onclick = e => {
      e.stopPropagation();
      nextImage();
    };

    document.getElementById("prev").onclick = e => {
      e.stopPropagation();
      prevImage();
    };

    lightbox.addEventListener("click", e => {
      if (e.target === lightbox) closeLightbox();
    });

    document.addEventListener("keydown", e => {
      if (lightbox.classList.contains("hidden")) return;
      if (e.key === "Escape") closeLightbox();
      if (e.key === "ArrowRight") nextImage();
      if (e.key === "ArrowLeft") prevImage();
    });
  });
</script>
