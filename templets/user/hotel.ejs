<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Hotels - NextTrip</title>

    <script src="https://cdn.tailwindcss.com"></script>
  </head>

  <body class="bg-gray-100">
    <!-- Navbar -->
    <%- include("navBar") %>

    <!-- Header -->
    <section
      class="text-center py-20 text-white bg-cover bg-center relative"
      style="background-image: url('/images/hotel-room-1447201_1280.jpg')"
    >
      <!-- Overlay -->
      <div class="absolute inset-0 bg-blue-700/50"></div>

      <div class="relative z-10">
        <h1 class="text-4xl font-bold">Find the Best Hotels</h1>
        <p class="mt-2 text-lg">Comfortable stays at the best prices</p>
      </div>
    </section>
    <!-- <section
      class="text-center py-20 text-white bg-cover bg-center relative"
      style="
        background-image: url('/images/eva-darron-1QlspiAMBk4-unsplash.jpg');
      "
    >
      <div class="absolute inset-0 bg-black/50"></div>
      <div class="relative z-10">
        <h1 class="text-4xl font-bold">Find the Best Hotels</h1>
        <p class="mt-2 text-lg">Comfortable stays at the best prices</p>
      </div>
    </section> -->

    <!-- Main Container -->
    <div class="max-w-7xl mx-auto px-6 py-10">
      <!-- Filters -->
      <div
        class="bg-white shadow p-5 rounded-xl mb-8 border grid grid-cols-1 md:grid-cols-3 gap-6"
      >
        <!-- Rating Filter -->
        <div>
          <label class="font-semibold">Rating</label>
          <select
            id="filterRating"
            class="w-full mt-1 p-3 border rounded-lg bg-gray-50"
          >
            <option value="all">All Ratings</option>
            <option value="4">4★ & above</option>
            <option value="3">3★ & above</option>
            <option value="2">2★ & above</option>
          </select>
        </div>

        <!-- Place Filter -->
        <div>
          <label class="font-semibold">Place</label>
          <select
            id="filterPlaces"
            class="w-full mt-1 p-3 border rounded-lg bg-gray-50"
          >
            <option value="all">All Places</option>
            <% 
              const uniquePlaces = [...new Set(hotels.map(h => h.place))];
              uniquePlaces.forEach((place) => { 
            %>
            <option value="<%= place %>"><%= place %></option>
            <% }); %>
          </select>
        </div>

      
      </div>

      <!-- Hotel Cards -->
      <div
        id="hotelContainer"
        class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8"
      >
        <% hotels.forEach(hotel => { %>
        <div class="bg-white border rounded-xl shadow overflow-hidden">
          <img
            src="/uploads/hotels/<%= hotel.images ? hotel.images[0] : hotel.image %>"
            class="h-48 w-full object-cover"
          />

          <div class="p-5">
            <h3 class="text-xl font-bold"><%= hotel.name %></h3>
            <p class="text-yellow-500 font-semibold mb-1">
              ⭐ <%= hotel.rating %>/5
            </p>
            <p class="text-gray-700 mb-2 font-medium">
              ₹ <%= hotel.description %> / night
            </p>

            <div class="flex gap-3 mt-4">
              <a
                href="/hotelRooms/<%= hotel._id %>"
                class="w-1/2 text-center bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700"
              >
                Book Now
              </a>

              <a
                href="/displayHotelDetails/<%= hotel._id %>"
                class="w-1/2 text-center border border-blue-600 text-blue-600 py-2 rounded-lg hover:bg-blue-50"
              >
                Details
              </a>
            </div>
          </div>
        </div>
        <% }) %>
      </div>
    </div>

    <%- include("footer") %>

    <!-- Filter Script -->
    <script>
      // Original hotels data
      const allHotels = <%- JSON.stringify(hotels) %>;

      // Get filter elements
      const ratingFilter = document.getElementById("filterRating");
      const placeFilter = document.getElementById("filterPlaces");

      // Filter and display hotels
      function applyFilters() {
        const selectedRating = ratingFilter.value;
        const selectedPlace = placeFilter.value;

        let filtered = allHotels;

        // Filter by rating
        if (selectedRating !== "all") {
          const minRating = parseFloat(selectedRating);
          filtered = filtered.filter(hotel => parseFloat(hotel.rating) >= minRating);
        }

        // Filter by place (case-insensitive)
        if (selectedPlace !== "all" && selectedPlace !== "") {
          filtered = filtered.filter(hotel => hotel.place.toLowerCase() === selectedPlace.toLowerCase());
        }

        // Render filtered hotels
        renderHotels(filtered);
      }

      // Render hotels to the DOM
      function renderHotels(hotelsToRender) {
        const container = document.getElementById("hotelContainer");
        
        if (hotelsToRender.length === 0) {
          container.innerHTML = '<div class="col-span-full text-center py-10"><p class="text-gray-600 text-lg">No hotels found matching your filters.</p></div>';
          return;
        }

        container.innerHTML = hotelsToRender.map(hotel => `
          <div class="bg-white border rounded-xl shadow overflow-hidden">
            <img
              src="/uploads/hotels/${hotel.images ? hotel.images[0] : hotel.image}"
              class="h-48 w-full object-cover"
              onerror="this.src='/images/placeholder.jpg'"
            />

            <div class="p-5">
              <h3 class="text-xl font-bold">${hotel.name}</h3>
              <p class="text-yellow-500 font-semibold mb-1">
                ⭐ ${hotel.rating}/5
              </p>
              <p class="text-gray-700 mb-2 font-medium">
                ₹ ${hotel.description} / night
              </p>
              <p class="text-gray-700 mb-2 font-medium">
                ₹ ${hotel.place} / night
              </p>


              <div class="flex gap-3 mt-4">
                <a
                  href="/hotelRooms/${hotel._id}"
                  class="w-1/2 text-center bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700"
                >
                  Book Now
                </a>

                <a
                  href="/hotelDetails/${hotel._id}"
                  class="w-1/2 text-center border border-blue-600 text-blue-600 py-2 rounded-lg hover:bg-blue-50"
                >
                  Details
                </a>
              </div>
            </div>
          </div>
        `).join("");
      }

      // Add event listeners
      ratingFilter.addEventListener("change", applyFilters);
      placeFilter.addEventListener("change", applyFilters);
    </script>
    
  </body>
</html>
